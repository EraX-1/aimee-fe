# AIエージェント（Aimee）Phase1 要件定義書

## 1. プロジェクト概要

### 1.1 目的
健保組合様の業務における人員配置の最適化を、AI技術を活用して自動化・効率化する。

### 1.2 主要機能
- リアルタイム人員配置最適化
- 生産性分析と予測
- 管理者への配置提案
- 過去の配置実績からの学習
- 納期が近い案件の自動アラート

## 2. システム構成

### 2.1 バッチ処理エンジン
- **バッチ2（配置情報取得エンジン）**: リアルタイムの配置状況と処理状況を取得（数値化できるデータ）
- **バッチ3（OP実績取得エンジン）**: オペレータの実績データを収集・分析（数値化しづらいデータ）

### 2.2 AIエンジン
- **RAG（Retrieval-Augmented Generation）**: 過去の配置実績と管理者ノウハウを活用
- **LLM（大規模言語モデル）**: 自然言語での対話インターフェース（ローカルGPU利用）
- **最適化アルゴリズム**: 数理最適化による人員配置計算

### 2.3 技術スタック
#### データ収集・バッチ処理
- スケジューラー: Apache Airflow / Prefect
- CSVデータ処理: pandas, polars
- データ検証: Great Expectations, pandera

#### データベース・ストレージ
- RDB: PostgreSQL + SQLAlchemy + psycopg2
- 時系列データ: TimescaleDB
- 接続プール: SQLAlchemy pool
- マイグレーション: Alembic

#### AIエンジン（RAG + LLM）
- ベクトルDB: ChromaDB / Qdrant / Weaviate
- 埋め込みモデル: sentence-transformers, OpenAI Embeddings
- LLMフレームワーク: LangChain / LlamaIndex
- ローカルLLM: Ollama + llama-cpp-python
- プロンプト管理: LangSmith / PromptLayer

#### 最適化エンジン
- 数理最適化: PuLP, OR-Tools, scipy.optimize
- 機械学習: scikit-learn, XGBoost, LightGBM
- 深層学習: PyTorch / TensorFlow（必要に応じて）

#### Web・API
- Webフレームワーク: FastAPI / Django REST Framework
- WebSocket: python-socketio
- 認証: python-jose (JWT), passlib

#### UI
- フレームワーク: Streamlit（Python）
- WebSocket対応: FastAPI + WebSocket

## 3. 機能要件

### 3.1 配置最適化機能
- 拠点内での人員配置最適化
- 拠点間での人員配置最適化（モード選択可能）
  - 【A工程であれば原則札幌】などの拠点別ルールを考慮
  - 拠点間調整時は管理者間のやり取りが必要なため初期条件設定が必要
- 工程別の進捗率を考慮した配置
  - 工程ごとの進捗の推移を考慮（引き抜いた側の工程の遅れを防ぐ）
  - 全体的な工程の進捗率を見た上での判断
- チーム単位での配慮
  - 各拠点の内部のチーム単位で工程を寄せる配慮（要確認事項）

### 3.2 データ分析機能
- リアルタイム処理状況の可視化
- 生産性トレンドの分析
- ボトルネック工程の特定
- 個人別パフォーマンス分析

### 3.3 AI学習機能
- 配置変更の成功/失敗パターンの学習
- 管理者の判断理由の蓄積と学習
- 承認/却下理由からのフィードバック学習
- 管理者が却下した場合の理由もRAGに取り込み

### 3.4 通知機能
- オペレータへの配置変更通知（端末への通知考慮必要）
- 管理者への最適化提案通知
- 納期が近い案件の自動アラート
- 管理者からの命令トリガーと自動提案の両方に対応

### 3.5 UI機能（2025年8月22日議事録より）
#### 作成予定ページ
1. **ダッシュボード（home画面）**
   - 全体の稼働状況サマリー
   - 重要指標の表示

2. **全体配置画面（人数確認）**
   - 拠点別・工程別の配置状況
   - リアルタイム人数表示

3. **グラフ監視画面**
   - 各種指標のグラフ表示
   - トレンド分析

4. **AIチャット**
   - 自然言語での問い合わせ
   - 配置提案の対話的な調整

5. **分析レポート**（仮）
   - 詳細な分析結果表示
   - （要件次第では不要）

6. **設定画面**
   - 各種パラメータ設定
   - 通知設定
   - 配置ルール設定

## 4. 非機能要件

### 4.1 性能要件
- 配置最適化計算：5分以内
- データ更新頻度：2分間隔
- 同時接続ユーザー数：100人

### 4.2 可用性
- システム稼働率：99.9%
- バックアップ：日次

### 4.3 セキュリティ
- 個人情報の適切な管理
- アクセス権限の制御
- 監査ログの記録

## 5. データ要件

### 5.1 出勤情報について
- 出勤情報（欠勤・遅刻情報）は不要と決定
- シフト状況の管理は対象外

### 5.2 RAG更新頻度
- 週次更新で問題なし
- 緊急時の配置調整はリアルタイムデータ（統合DB）を参照

### 5.3 データ保持期間
- 過去データは要件に応じて決定
- AI学習データは長期保持を推奨

## 6. 制約事項

### 6.1 技術的制約
- ローカルGPUでの処理を前提
- 既存システムとのAPI連携が必要
- 管理画面が業務ごとに分かれている

### 6.2 運用上の制約
- 拠点ごとの配置ルールの考慮
- 管理者の最終承認が必要
- 段階的な導入を想定

### 6.3 データアクセス
- 既存データベースへのアクセス許可、またはEraX側DBへの取り込みが必要
- CSVファイルの自動取得仕組みの構築

## 7. UI開発方針（2025年8月22日決定）

### 7.1 開発アプローチ
- 現状のデータを用いてローカルmockで開発
- 実現可能な全ページを一旦作成し、その後ブラッシュアップ
- 情報量を削ぎ落とし、使いやすいページへマージ

### 7.2 利用技術
- Python（Streamlitによるアプリケーション）
- 計算ライブラリ、グラフ描画ライブラリ
- FastAPIによるバックエンド（必要に応じて）

## 8. 今後の拡張予定

### Phase2以降
- 予測精度の向上
- より高度な最適化アルゴリズムの実装
- 他システムとの連携強化
- モバイル対応

## 9. 次期アクション項目

### トランス・コスモス様
- 各種データ収集・連携方法の整理
- 拠点ごとの配置ルールを加味する必要性の確認
- ローカルGPUの金額・請求方法の検討
- 契約書関連（お盆明けを目処）

### EraX
- UIモックアップの作成（お盆明け共有予定）
- データベース設計の詳細化
- システム構成の最終化