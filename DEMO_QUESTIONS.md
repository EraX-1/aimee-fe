# デモ動画用 質問文パターン (本番データベース)

## 📊 本番データの状況

### 拠点別オペレータ配置
- **品川**: 4名 (うち3名がSS>新SS(W)>OCR対象>エントリ1のスキル保有)
- **札幌**: 4名 (うち2名がSS>新SS(W)>OCR対象>エントリ1のスキル保有)
- **本町東**: 3名 (うち2名がSS>新SS(W)>OCR対象>エントリ1のスキル保有)
- **佐世保**: 2名 (うち2名がSS>新SS(W)>OCR非対象>エントリ2のスキル保有)
- **沖縄**: 1名
- **西梅田**: 1名

### 業務×工程別スキル保有者数
- **SS > 新SS(W) > OCR対象 > エントリ1**: 7名
  - 品川: 3名 (田中太郎, 佐藤花子, 鈴木一郎)
  - 本町東: 2名 (渡辺健一, 伊藤さくら)
  - 札幌: 2名 (井村美子, 高橋美咲)

- **SS > 新SS(W) > OCR対象 > エントリ2**: 1名

- **SS > 新SS(W) > OCR非対象 > エントリ2**: 3名
  - 佐世保: 2名 (中村真理, 小林優子)
  - 沖縄: 1名 (山本直樹)

- **SS > 新SS(W) > OCR対象 > 補正**: 3名
  - 品川: 2名 (田中太郎, 佐藤花子)
  - 札幌: 1名 (加藤正義)

---

## 🎯 デモ用質問文パターン (4階層明示)

### パターン1: 基本的な配置提案依頼 ⭐推奨

**ユーザー質問**:
```
札幌の「SS」の「新SS(W)」の「OCR対象」の「エントリ1」が人員不足で遅延しています。
どこかから人を移動できませんか?
```

**期待されるAI応答**:
```
札幌の「SS」の「新SS(W)」の「OCR対象」の「エントリ1」の人員不足を解決するため、
品川から以下の配置転換を提案します。

【提案内容】
大分類: SS (社会保険)
業務タイプ: 新SS(W)
OCR区分: OCR対象
工程: エントリ1

【配置転換】
- 移動元: 品川 (現在3名配置)
- 移動先: 札幌 (現在2名配置)
- 対象者: 田中 太郎さん、佐藤 花子さん

【理由】
品川は現在3名配置されており、1名残しても業務継続が可能です。
札幌は現在2名ですが、遅延が発生しているため4名に増員することで
生産性が向上します。

【期待効果】
- 札幌の生産性: +25%向上見込み
- 遅延削減: 約30分短縮
```

---

### パターン2: より詳細な階層指定

**ユーザー質問**:
```
「SS」の「新SS(W)」の「OCR非対象」の「エントリ2」工程で、
佐世保の進捗が遅れているようです。
他拠点から応援を出せますか?
```

**期待されるAI応答**:
```
佐世保の「SS」の「新SS(W)」の「OCR非対象」の「エントリ2」の遅延解消のため、
沖縄から以下の配置転換を提案します。

【提案内容】
大分類: SS (社会保険)
業務タイプ: 新SS(W)
OCR区分: OCR非対象
工程: エントリ2

【配置転換】
- 移動元: 沖縄 (現在1名配置)
- 移動先: 佐世保 (現在2名配置)
- 対象者: 山本 直樹さん

【理由】
佐世保は現在2名配置で遅延が発生しています。
沖縄から1名移動することで、3名体制となり遅延が解消されます。

【期待効果】
- 佐世保の生産性: +20%向上見込み
- 遅延削減: 約20分短縮
```

---

### パターン3: 複数工程の同時提案

**ユーザー質問**:
```
札幌の「SS」の「新SS(W)」で人員が足りていません。
「OCR対象」の「エントリ1」と「補正」の両方で配置を調整してください。
```

**期待されるAI応答**:
```
札幌の「SS」の「新SS(W)」における2つの工程の人員不足を解決するため、
品川から以下の配置転換を提案します。

【提案1】OCR対象 > エントリ1
- 移動元: 品川 (現在3名配置)
- 移動先: 札幌 (現在2名配置)
- 対象者: 田中 太郎さん

【提案2】OCR対象 > 補正
- 移動元: 品川 (現在2名配置)
- 移動先: 札幌 (現在1名配置)
- 対象者: 佐藤 花子さん

【理由】
田中太郎さんは「エントリ1」と「補正」の両方のスキルを保有しており、
柔軟な配置が可能です。佐藤花子さんも同様に複数スキルを保有しています。

【期待効果】
- 札幌の生産性: +30%向上見込み
- 遅延削減: 約40分短縮
```

---

## 🔧 バックエンド修正のポイント

### 1. データ取得時に4階層を含める

```python
query = """
SELECT
    l.location_name,
    b.business_category,
    b.business_name,
    p.process_category,
    p.process_name,
    GROUP_CONCAT(o.operator_name SEPARATOR ', ') as operators,
    COUNT(DISTINCT o.operator_id) as count
FROM
    operators o
    INNER JOIN operator_process_capabilities opc ON o.operator_id = opc.operator_id
    INNER JOIN locations l ON o.location_id = l.location_id
    INNER JOIN businesses b ON opc.business_id = b.business_id
    INNER JOIN processes p ON opc.business_id = p.business_id AND opc.process_id = p.process_id
WHERE
    o.is_valid = 1
GROUP BY
    l.location_name, b.business_category, b.business_name, p.process_category, p.process_name
"""
```

### 2. AIプロンプトに階層明示を指示

```python
prompt = f"""
あなたは配置最適化AIアシスタントです。

【重要】配置提案時は、必ず以下の4階層を明示してください:
1. 大分類: SS / 非SS / あはき / 適用徴収
2. 業務タイプ: 新SS(W) / 新SS(片道) など
3. OCR区分: OCR対象 / OCR非対象 / 目検
4. 工程名: エントリ1 / エントリ2 / 補正 / SV補正

【回答フォーマット】
「(大分類)」の「(業務タイプ)」の「(OCR区分)」の「(工程名)」に◯◯さん、◯◯さんを移動してください。

例: 「SS」の「新SS(W)」の「OCR対象」の「エントリ1」に田中太郎さん、佐藤花子さんを移動してください。

【現在のデータベース情報】
{database_context}

【ユーザーの質問】
{user_message}
"""
```

---

## 📝 テスト手順

1. バックエンドのプロンプトを修正
2. 上記の質問文パターン1をAPIに送信
3. レスポンスを確認
4. 4階層が明示されているか確認
5. オペレータ名が具体的に提示されているか確認
6. 不適切ならプロンプトをチューニング
7. パターン2, 3でも同様にテスト

---

**作成日**: 2025-10-09
**データソース**: 本番データベース (15名のオペレータ)
